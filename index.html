<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™ IT19 by misspklk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            min-height: 100vh;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        .glow {
            text-shadow: 0 0 10px rgba(66, 153, 225, 0.8);
        }
        .btn-blue {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            transition: all 0.3s ease;
        }
        .btn-blue:hover {
            background: linear-gradient(45deg, #2a5298, #1e3c72);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .btn-blue:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .spinner {
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold mb-2 glow">‡∏™‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™ IT19</h1>
            <p class="text-blue-200">‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ö‡πâ‡∏™‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà‡πÜ‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≠‡∏á‡πÜ IT19</p>
            <div id="connectionStatus" class="mt-2 text-sm">
                <span class="text-yellow-300">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
            </div>
        </header>

        <div class="flex flex-col md:flex-row gap-6 justify-center">
            <!-- ‡∏ù‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ -->
            <div class="card rounded-xl p-6 w-full md:w-1/2 max-w-lg">
                <h2 class="text-2xl font-bold mb-4 text-center text-blue-300">‡∏ù‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</h2>
                <form id="hintForm" class="space-y-4">
                    <div>
                        <label class="block mb-1 text-blue-200">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (10 ‡∏´‡∏•‡∏±‡∏Å)</label>
                        <input type="text" id="senderStudentId" maxlength="10" class="w-full px-4 py-2 rounded-lg bg-blue-900/50 border border-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤" required>
                    </div>
                    <div>
                        <label class="block mb-1 text-blue-200">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏á (10 ‡∏´‡∏•‡∏±‡∏Å)</label>
                        <input type="text" id="receiverStudentId" maxlength="10" class="w-full px-4 py-2 rounded-lg bg-blue-900/50 border border-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏á" required>
                    </div>
                    <div>
                        <label class="block mb-1 text-blue-200">‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</label>
                        <textarea id="hintText" rows="4" class="w-full px-4 py-2 rounded-lg bg-blue-900/50 border border-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." required></textarea>
                    </div>
                    <button type="submit" id="submitHintBtn" class="w-full btn-blue text-white py-3 px-6 rounded-lg font-medium">
                        <span id="submitHintText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</span>
                    </button>
                </form>
                
                <div id="hintSuccess" class="hidden mt-4 p-3 bg-green-800/50 border border-green-700 rounded-lg text-green-200 text-center">
                    ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!
                </div>
                
                <div id="hintError" class="hidden mt-4 p-3 bg-red-800/50 border border-red-700 rounded-lg text-red-200 text-center">
                    ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </div>
            </div>

            <!-- ‡∏ù‡∏±‡πà‡∏á‡∏î‡∏π‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ -->
            <div class="card rounded-xl p-6 w-full md:w-1/2 max-w-lg">
                <h2 class="text-2xl font-bold mb-4 text-center text-blue-300">‡∏ù‡∏±‡πà‡∏á‡∏î‡∏π‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</h2>
                <form id="viewHintForm" class="space-y-4">
                    <div>
                        <label class="block mb-1 text-blue-200">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (10 ‡∏´‡∏•‡∏±‡∏Å)</label>
                        <input type="text" id="viewStudentId" maxlength="10" class="w-full px-4 py-2 rounded-lg bg-blue-900/50 border border-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>
                    </div>
                    <button type="submit" id="viewHintBtn" class="w-full btn-blue text-white py-3 px-6 rounded-lg font-medium">
                        <span id="viewHintText">‡∏î‡∏π‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</span>
                    </button>
                </form>
                
                <div id="noHintMessage" class="hidden mt-4 p-3 bg-yellow-800/50 border border-yellow-700 rounded-lg text-yellow-200 text-center">
                    üòî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ
                </div>
                
                <div id="hintResult" class="hidden mt-4 space-y-3">
                    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
                
                <div id="viewError" class="hidden mt-4 p-3 bg-red-800/50 border border-red-700 rounded-lg text-red-200 text-center">
                    ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </div>
            </div>
        </div>

        <footer class="mt-12 text-center text-blue-300 text-sm">
            <p>üíª ‡∏™‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™ IT19 - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á IT</p>
            <p class="mt-1 text-xs text-blue-400">Powered by Supabase üöÄ</p>
        </footer>
    </div>

    <script>
        // ‚ö†Ô∏è ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Supabase 
        const SUPABASE_URL = 'https://flxnhqfknfyimnhsqhva.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZseG5ocWZrbmZ5aW1uaHNxaHZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyMjEyMTYsImV4cCI6MjA2NDc5NzIxNn0.i2CwcWa-5l99NX9GxD9lNAftd43J8pozsR0XdJ7E4Ic';
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        async function checkConnection() {
            try {
                const { data, error } = await supabase.from('hints').select('count').limit(1);
                if (error) throw error;
                
                document.getElementById('connectionStatus').innerHTML = 
                    '<span class="text-green-300">‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>';
            } catch (error) {
                console.error('Connection error:', error);
                document.getElementById('connectionStatus').innerHTML = 
                    '<span class="text-red-300">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</span>';
            }
        }
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î
        checkConnection();
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á loading
        function showLoading(buttonId, textId, loadingText) {
            const btn = document.getElementById(buttonId);
            const text = document.getElementById(textId);
            btn.disabled = true;
            text.innerHTML = `<div class="spinner inline-block"></div>${loadingText}`;
        }
        
        function hideLoading(buttonId, textId, normalText) {
            const btn = document.getElementById(buttonId);
            const text = document.getElementById(textId);
            btn.disabled = false;
            text.textContent = normalText;
        }
        
        // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ
        document.getElementById('hintForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const senderStudentId = document.getElementById('senderStudentId').value.trim();
            const receiverStudentId = document.getElementById('receiverStudentId').value.trim();
            const hintText = document.getElementById('hintText').value.trim();
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
            if (senderStudentId.length !== 10 || receiverStudentId.length !== 10) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å');
                return;
            }
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤
            document.getElementById('hintSuccess').classList.add('hidden');
            document.getElementById('hintError').classList.add('hidden');
            
            // ‡πÅ‡∏™‡∏î‡∏á loading
            showLoading('submitHintBtn', 'submitHintText', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...');
            
            try {
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Supabase
                const { data, error } = await supabase
                    .from('hints')
                    .insert([
                        {
                            sender_student_id: senderStudentId,
                            receiver_student_id: receiverStudentId,
                            hint_text: hintText
                        }
                    ]);
                
                if (error) throw error;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                document.getElementById('hintSuccess').classList.remove('hidden');
                
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
                document.getElementById('hintText').value = '';
                document.getElementById('receiverStudentId').value = '';
                
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏•‡∏±‡∏á 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                setTimeout(() => {
                    document.getElementById('hintSuccess').classList.add('hidden');
                }, 5000);
                
            } catch (error) {
                console.error('Error saving hint:', error);
                document.getElementById('hintError').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('hintError').classList.add('hidden');
                }, 5000);
            } finally {
                hideLoading('submitHintBtn', 'submitHintText', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ');
            }
        });
        
        // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡∏π‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ
        document.getElementById('viewHintForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentId = document.getElementById('viewStudentId').value.trim();
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
            if (studentId.length !== 10) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å');
                return;
            }
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏Å‡πà‡∏≤
            document.getElementById('noHintMessage').classList.add('hidden');
            document.getElementById('hintResult').classList.add('hidden');
            document.getElementById('viewError').classList.add('hidden');
            
            // ‡πÅ‡∏™‡∏î‡∏á loading
            showLoading('viewHintBtn', 'viewHintText', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...');
            
            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Supabase
                const { data, error } = await supabase
                    .from('hints')
                    .select('*')
                    .eq('receiver_student_id', studentId)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                if (!data || data.length === 0) {
                    // ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ
                    document.getElementById('noHintMessage').classList.remove('hidden');
                } else {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    const hintResultDiv = document.getElementById('hintResult');
                    hintResultDiv.innerHTML = '';
                    
                    data.forEach((hint, index) => {
                        const hintElement = document.createElement('div');
                        hintElement.className = 'p-4 bg-blue-900/50 border border-blue-700 rounded-lg';
                        
                        const date = new Date(hint.created_at).toLocaleString('th-TH');
                        
                        hintElement.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-lg text-blue-300">‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ #${data.length - index}</h3>
                                <span class="text-xs text-blue-400">${date}</span>
                            </div>
                            <p class="text-white mb-2">${hint.hint_text}</p>
                            <p class="text-sm text-blue-300">‡∏à‡∏≤‡∏Å: ${hint.sender_student_id.slice(0, 6)}****</p>
                        `;
                        
                        hintResultDiv.appendChild(hintElement);
                    });
                    
                    hintResultDiv.classList.remove('hidden');
                }
                
            } catch (error) {
                console.error('Error fetching hints:', error);
                document.getElementById('viewError').classList.remove('hidden');
            } finally {
                hideLoading('viewHintBtn', 'viewHintText', '‡∏î‡∏π‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ');
            }
        });
    </script>
</body>
</html>
